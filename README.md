# Лабораторная работа №2: Мини-оболочка с файловыми командами

## Цель работы
Освоить работу с файловой системой средствами Python, реализовать основные команды управления файлами и каталогами, научиться вести журнал действий пользователя.

---

## Требования

### Обязательная часть (Easy)
- Команда `ls` - отображение списка файлов и каталогов
- Команда `cd` - переход в указанный каталог
- Команда `cat` - вывод содержимого файла
- Команда `cp` - копирование файлов и каталогов
- Команда `mv` - перемещение
- Команда `rm` - удаление файлов и каталогов
- Логирование всех операций

### Дополнительная часть (Medium)
- Работа с архивами ZIP и TAR
- Поиск файлов по содержимому (grep)
### Дополнительная функционал невходящий в задание лабы
- Утилиты (mkdir, touch)

---

## Архитектура решения

### Структура проекта
```
lab2/
├── src/
│   ├── class_commands/
│   │   ├── cat_com.py
│   │   ├── cd_com.py
│   │   ├── cp_com.py
│   │   ├── grep_com.py
│   │   ├── ls_com.py
│   │   ├── mkdir_com.py
│   │   ├── mv_com.py
│   │   ├── rm_com.py
│   │   ├── tar_com.py
│   │   ├── touch_com.py
│   │   └── zip_com.py
│   ├── logging/
│   │   └── logger.py
│   └── main.py
├── requirements.txt
└── README.md
```

### Ключевые особенности
- **Модульная архитектура** - каждая команда в отдельном классе
- **Единое логирование** через декоратор `@command_logger`
- **Обработка ошибок**
- **Поддержка относительных и абсолютных путей**
- **Проверки прав доступа** для всех операций

---

## Справка по использованию

### Общая справка
Для получения справки по всем доступным командам используйте:
```
python -m src.main --help
```
### Справка по отдельным командам
Для получения подробной информации о каждой команде используйте `--help` после команды:
```
ls --help
cp --help
grep --help
```
---
## Реализованные команды

### Файловые операции

#### `cat` - вывод содержимого файла / нескольких файлов подряд
```
cat file.txt
cat file_1.txt file_2.txt
```
- Проверка существования файла
- Проверка что это не каталог
- Проверка прав на чтение

#### `cp` - копирование файлов и каталогов
```
cp source.txt destination.txt
cp -r source_dir/ destination_dir/
cp file1.txt file2.txt target_dir/
```
- Рекурсивное копирование каталогов (`-r`)
- Поддержка множественных источников
- Проверки прав доступа
- Защита от копирования в самого себя

#### `mv` - перемещение и переименование
```
mv old_name.txt new_name.txt
mv file.txt target_dir/
mv dir1/ dir2/ target_dir/
```

- Проверка прав доступа
- Защита от перемещения в самого себя

#### `rm` - удаление файлов и каталогов
```
rm file.txt
rm -r dir/
```
- Подтверждение удаления для каталогов
- Защита от удаления корневого и родительского каталогов
- Рекурсивное удаление (`-r`)

### Операции с каталогами

#### `ls` - список файлов и каталогов
```
ls
ls /path/to/dir
ls -l
```
- Подробный вывод с правами, размером и датой (`-l`)
- Форматирование как в UNIX-подобной оболочке
- Автоматическое добавление `/` к каталогам

#### `cd` - смена каталога
```
cd /path/to/dir
cd ..
cd ~
```
- Поддержка специальных путей (`..`, `~`)
- Проверка существования каталога
---

### Особенности реализации

#### Важное замечание по команде cd
Команда cd полностью функциональна внутри оболочки и изменяет текущую рабочую директорию для всех последующих операций. Однако, поскольку оболочка работает как отдельный процесс, изменение директории не сохраняется в родительском терминале после завершения работы программы.
Это ожидаемое поведение и кажется не противоречит условиям

---
#### `mkdir` - создание каталогов
```
mkdir new_dir
mkdir dir1 dir2 dir3
```
- Создание нескольких каталогов
- Проверка существования

#### `touch` - создание файлов
```
touch new_file.txt
touch file1.txt file2.txt
```
- Создание нескольких файлов

### Работа с архивами

#### `zip` - создание ZIP архивов
```
zip folder/ archive.zip
```
- Автоматическое добавление расширения `.zip`
- Подтверждение перезаписи

#### `unzip` - распаковка ZIP
```
unzip archive.zip
unzip archive.zip target_dir/
```
- Распаковка в текущий или указанный каталог
- Подтверждение перезаписи существующих файлов

#### `tar` - создание TAR.GZ архивов
```
tar folder/ archive.tar.gz
```
- Автоматическое добавление расширения `.tar.gz`
- Сжатие в формате gzip

#### `untar` - распаковка TAR.GZ
```
untar archive.tar.gz
untar archive.tar.gz target_dir/
```
- Распаковка с сохранением структуры
- Подтверждение перезаписи

### Поиск
#### grep - поиск по содержимому
```
grep "pattern" file.txt
grep -r "pattern" directory/
grep -i "PATTERN" file.txt
```
- Рекурсивный поиск (-r)
- Поиск без учета регистра (-i)
- Вывод имени файла и номера строки и найденного фрагмента(цветное) :)

---

## Логирование

Все команды и ошибки логируются в файл shell.log:
```
[2024-01-15 10:30:45] ls -l /home/user
[2024-01-15 10:30:46] SUCCESS
[2024-01-15 10:31:22] rm important_file.txt
[2024-01-15 10:31:23] ERROR: Permission denied
```
---

## Запуск

### Установка зависимостей
```
pip install -r requirements.txt
```
### Запуск оболочки
```
python -m src.main
```
---

## Безопасность и проверки

### Проверки прав доступа
- Чтение: os.access(path, os.R_OK)
- Запись: os.access(path, os.W_OK)
- Выполнение: os.access(path, os.X_OK)

### Защищенные пути
- Запрет удаления корневого каталога /
- Запрет удаления родительского каталога ..
- Проверка на копирование/перемещение в самого себя

### Подтверждения действий
- Удаление каталогов
- Перезапись архивов
- Критические операции

---

## Итоги

### Реализованные функции
-  Все обязательные команды для Easy
-  Работа с архивами ZIP/TAR
-  Поиск по содержимому (grep)
-  Дополнительные утилиты (mkdir, touch)
-  Полное логирование операций
-  Обработка ошибок

### Полученные навыки
- Работа с файловой системой в Python
- Создание консольных утилит
- Обработка исключений и прав доступа
- Логирование пользовательских действий
